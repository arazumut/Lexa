{{ define "content" }}
<div class="block-header">
    <div class="row">
        <div class="col-lg-6 col-md-8 col-sm-12">
            <h2><a href="javascript:void(0);" class="btn btn-xs btn-link btn-toggle-fullwidth"><i
                        class="fa fa-arrow-left"></i></a> Müvekkil Profili</h2>
            <ul class="breadcrumb">
                <li class="breadcrumb-item"><a href="/"><i class="icon-home"></i></a></li>
                <li class="breadcrumb-item"><a href="/clients">Müvekkiller</a></li>
                <li class="breadcrumb-item active">Müvekkil Detayı</li>
            </ul>
        </div>
        <div class="col-lg-6 col-md-4 col-sm-12 text-right">
            <a href="/clients/{{ .client.ID }}/edit" class="btn btn-info"><i class="fa fa-pencil"></i> Düzenle</a>
            <button type="button" class="btn btn-danger" onclick="deleteClient({{ .client.ID }})"><i
                    class="fa fa-trash"></i> Sil</button>
        </div>
    </div>
</div>

<div class="row clearfix">
    <!-- Sol Kolon: Profil Kartı -->
    <div class="col-lg-4 col-md-12">
        <div class="card profile-header">
            <div class="body text-center">
                <div class="profile-image">
                    <img src="/assets/images/user.png" class="rounded-circle" alt="User">
                </div>
                <div>
                    <h4 class="m-b-0"><strong>{{ .client.Name }}</strong></h4>
                    <span>{{ if eq .client.Type "corporate" }}Kurumsal{{ else }}Bireysel{{ end }}</span>
                </div>
                <!-- İleride buraya Bakiye Bilgisi Gelecek -->
            </div>
        </div>

        <div class="card">
            <div class="header">
                <h2>İletişim & Detaylar</h2>
            </div>
            <div class="body">
                <small class="text-muted">TC / Vergi No:</small>
                <p>{{ .client.Identity }}</p>
                <hr>
                <small class="text-muted">Telefon:</small>
                <p>{{ .client.Phone }}</p>
                <hr>
                <small class="text-muted">Email:</small>
                <p>{{ .client.Email }}</p>
                <hr>
                <small class="text-muted">Adres:</small>
                <p>{{ .client.Address }}</p>
                <div class="mapouter">
                    <div class="gmap_canvas"><iframe width="100%" height="200" id="gmap_canvas"
                            src="https://maps.google.com/maps?q={{ .client.Address }}&t=&z=13&ie=UTF8&iwloc=&output=embed"
                            frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sağ Kolon: Sekmeler (Davalar, Notlar) -->
    <div class="col-lg-8 col-md-12">
        <div class="card">
            <div class="body">
                <ul class="nav nav-tabs-new">
                    <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#Cases">Davalar <span
                                class="badge badge-primary">{{ len .client.Cases }}</span></a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#Notes">Notlar</a></li>
                    <!-- İleride: Finans Geçmişi -->
                </ul>
                <div class="tab-content mt-3">

                    <!-- 1. DAVALAR -->
                    <div class="tab-pane active" id="Cases">
                        <div class="header d-flex justify-content-between">
                            <h2>Bağlı Dava Dosyaları</h2>
                            <a href="/cases/new?client_id={{ .client.ID }}" class="btn btn-sm btn-outline-primary"><i
                                    class="fa fa-plus"></i> Yeni Dava Aç</a>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Dosya No</th>
                                        <th>Konu</th>
                                        <th>Mahkeme</th>
                                        <th>Durum</th>
                                        <th>İşlem</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {{ range .client.Cases }}
                                    <tr>
                                        <td><a href="/cases/{{ .ID }}"><strong>{{ .FileNumber }}</strong></a></td>
                                        <td>{{ .Title }}</td>
                                        <td>{{ .Court }}</td>
                                        <td>
                                            {{ if eq .Status "active" }}<span class="badge badge-success">Aktif</span>
                                            {{ else }}<span class="badge badge-secondary">{{ .Status }}</span>{{ end }}
                                        </td>
                                        <td>
                                            <a href="/cases/{{ .ID }}" class="btn btn-sm btn-outline-secondary"
                                                title="Detay"><i class="fa fa-eye"></i></a>
                                        </td>
                                    </tr>
                                    {{ else }}
                                    <tr>
                                        <td colspan="5" class="text-center text-muted">Bu müvekkile ait dava dosyası
                                            bulunamadı.</td>
                                    </tr>
                                    {{ end }}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- 2. NOTLAR -->
                    <div class="tab-pane" id="Notes">
                        <h6>Müvekkil Hakkında Notlar</h6>
                        <p>{{ if .client.Notes }}{{ .client.Notes }}{{ else }}Özel bir not girilmemiş.{{ end }}</p>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
{{ end }}

{{ define "scripts" }}
<script>
    function deleteClient(id) {
        if (!confirm('DİKKAT! Bu işlem geri alınamaz. Bu müvekkili silmek istediğinize emin misiniz?')) return;

        fetch('/api/clients/' + id, { method: 'DELETE' })
            .then(response => {
                if (response.ok) {
                    toastr.success('Müvekkil silindi.');
                    setTimeout(() => window.location.href = '/clients', 1000);
                } else {
                    toastr.error('Silinemedi.');
                }
            });
    }
</script>
{{ end }}