<!doctype html>
<html lang="tr">

<head>
    <title>{{ if .title }}{{ .title }}{{ else }}LEXA - Legal Office System{{ end }}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Lexa Legal Office Management System">
    <meta name="author" content="Lexa">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- VENDOR CSS -->
    <link rel="stylesheet" href="/assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/assets/vendor/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/vendor/toastr/toastr.min.css">
    <link rel="stylesheet" href="/assets/vendor/charts-c3/plugin.css" />
    <!-- DataTables Responsive CSS (CDN) -->
    <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.5.0/css/responsive.bootstrap4.min.css">

    <!-- MAIN Project CSS file -->
    <link rel="stylesheet" href="/assets/css/main.css">

    <style>
        /* Modern Mobil Header ve Layout DÃ¼zenlemesi (KESÄ°N Ã‡Ã–ZÃœM) */
        @media (max-width: 767px) {

            /* Navbar AyarlarÄ± */
            .navbar-fixed-top {
                padding: 0 10px;
                left: 0 !important;
                width: 100% !important;
                z-index: 10002;
            }

            .navbar-brand {
                float: none;
                display: flex;
                align-items: center;
                justify-content: space-between;
                width: 100%;
                margin-right: 0;
            }

            .navbar-right,
            .navbar-form {
                display: none !important;
            }

            /* Sidebar AyarlarÄ± */
            #left-sidebar {
                left: -300px;
                position: fixed;
                z-index: 10003;
                height: 100vh;
                width: 280px;
                transition: all 0.3s ease-in-out;
                box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            }

            #left-sidebar.mobile-active {
                left: 0;
            }

            /* Ä°Ã‡ERÄ°K NO-SCROLL & FULL WIDTH AYARLARI */
            body {
                overflow-x: hidden;
            }

            #main-content {
                width: 100vw !important;
                margin: 0 !important;
                left: 0 !important;
                padding-top: 70px;
                /* Navbar YÃ¼ksekliÄŸi */
                padding-left: 0 !important;
                padding-right: 0 !important;
            }

            #main-content .container-fluid {
                padding-left: 15px !important;
                padding-right: 15px !important;
                width: 100% !important;
            }

            /* DiÄŸer */
            .btn-toggle-offcanvas {
                display: block !important;
                float: left;
                margin-right: 15px;
                color: #fff;
                font-size: 24px;
                background: none;
                border: none;
            }

            .navbar-brand a {
                color: #fff;
                font-size: 22px;
                font-weight: bold;
                text-decoration: none;
            }

            .mobile-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.6);
                z-index: 10001;
                backdrop-filter: blur(2px);
            }

            .mobile-overlay.active {
                display: block;
            }

            /* Gizlenecekler */
            .right_icon_bar {
                display: none !important;
            }

            /* Full Width Toggle Gizle (Mobile) */
            .btn-toggle-fullwidth {
                display: none !important;
            }

            /* Mobil Ã‡Ä±kÄ±ÅŸ Butonu */
            .mobile-logout-btn {
                display: block;
                color: #fff;
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
            }
        }
    </style>
</head>

<body data-theme="light" class="font-nunito">
    <div id="wrapper" class="theme-cyan">

        <!-- Page Loader -->


        <!-- Top navbar div start -->
        <nav class="navbar navbar-fixed-top">
            <div class="container-fluid">
                <div class="navbar-brand">
                    <button type="button" class="btn-toggle-offcanvas"><i class="fa fa-bars"></i></button>
                    <button type="button" class="btn-toggle-fullwidth"><i class="fa fa-bars"></i></button>
                    <a href="/">LEXA</a>
                    <!-- Mobile Logout Button (GÃ¶rÃ¼nÃ¼r olmasÄ± iÃ§in) -->
                    <button type="button" class="mobile-logout-btn d-md-none" onclick="logout()"><i
                            class="fa fa-power-off"></i></button>
                </div>

                <div class="navbar-right">
                    <form id="navbar-search" class="navbar-form search-form">
                        <input value="" class="form-control" placeholder="Arama..." type="text">
                        <button type="button" class="btn btn-default"><i class="icon-magnifier"></i></button>
                    </form>

                    <div id="navbar-menu">
                        <ul class="nav navbar-nav">
                            <li>
                                <a href="javascript:void(0);" onclick="logout()" class="icon-menu"><i
                                        class="fa fa-power-off"></i></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </nav>

        <!-- main left menu -->
        <div id="left-sidebar" class="sidebar">
            <button type="button" class="btn-toggle-offcanvas"><i class="fa fa-arrow-left"></i></button>
            <div class="sidebar-scroll">
                <div class="user-account">
                    <img src="/assets/images/user.png" class="rounded-circle user-photo" alt="User Profile Picture">
                    <div class="dropdown">
                        <span>HoÅŸgeldin,</span>
                        <a href="javascript:void(0);" class="dropdown-toggle user-name"
                            data-toggle="dropdown"><strong>{{ .email }}</strong></a>
                        <ul class="dropdown-menu dropdown-menu-right account">
                            <li><a href="#"><i class="icon-user"></i>Profilim</a></li>
                            <li><a href="#"><i class="icon-settings"></i>Ayarlar</a></li>
                            <li class="divider"></li>
                            <li><a href="javascript:void(0);" onclick="logout()"><i class="icon-power"></i>Ã‡Ä±kÄ±ÅŸ</a>
                            </li>
                        </ul>
                    </div>
                    <!-- Mini Stats -->
                    <hr>
                    <ul class="row list-unstyled">
                        <li class="col-4">
                            <small>Dosyalar</small>
                            <h6 id="mini-stat-files">...</h6>
                        </li>
                        <li class="col-4">
                            <small>MÃ¼vekkil</small>
                            <h6 id="mini-stat-clients">...</h6>
                        </li>
                        <li class="col-4">
                            <small>Bakiye</small>
                            <h6 id="mini-stat-balance">...</h6>
                        </li>
                    </ul>
                </div>
                <!-- Nav tabs -->
                <ul class="nav nav-tabs">
                    <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#menu">Menu</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#setting"><i
                                class="icon-settings"></i></a></li>
                </ul>

                <!-- Tab panes -->
                <div class="tab-content padding-0">
                    <div class="tab-pane active" id="menu">
                        <nav id="left-sidebar-nav" class="sidebar-nav">
                            <ul id="main-menu" class="metismenu li_animation_delay">
                                <li id="menu-dashboard">
                                    <a href="/" class="has-arrow"><i
                                            class="fa fa-dashboard"></i><span>Dashboard</span></a>
                                </li>
                                <li id="menu-clients">
                                    <a href="/clients"><i class="fa fa-users"></i><span>MÃ¼vekkiller</span></a>
                                </li>
                                <li id="menu-cases">
                                    <a href="#Cases" class="has-arrow" aria-expanded="false"><i
                                            class="fa fa-folder"></i><span>Dava DosyalarÄ±</span></a>
                                    <ul aria-expanded="false" class="collapse">
                                        <li><a href="/cases">TÃ¼m Dosyalar</a></li>
                                        <li><a href="/cases/new">Yeni Dosya Ekle</a></li>
                                    </ul>
                                </li>
                                <li id="menu-hearings">
                                    <a href="#Hearings" class="has-arrow" aria-expanded="false"><i
                                            class="fa fa-calendar"></i><span>DuruÅŸmalar</span></a>
                                    <ul aria-expanded="false" class="collapse">
                                        <li><a href="/hearings">Takvim / Liste</a></li>
                                        <li><a href="/hearings/new">Yeni DuruÅŸma Ekle</a></li>
                                    </ul>
                                </li>
                                <li id="menu-accounting">
                                    <a href="#Accounting" class="has-arrow" aria-expanded="false"><i
                                            class="fa fa-money"></i><span>Muhasebe</span></a>
                                    <ul aria-expanded="false" class="collapse">
                                        <li><a href="/accounting">Finansal Hareketler</a></li>
                                        <li><a href="/accounting/new">Yeni Ä°ÅŸlem Ekle</a></li>
                                    </ul>
                                </li>
                                <li>
                                    <a href="javascript:void(0);" onclick="logout()"><i
                                            class="fa fa-power-off"></i><span>Ã‡Ä±kÄ±ÅŸ Yap</span></a>
                                </li>
                            </ul>
                        </nav>
                    </div>

                    <div class="tab-pane" id="setting">
                        <h6>Tema SeÃ§imi</h6>
                        <ul class="choose-skin list-unstyled">
                            <li data-theme="purple">
                                <div class="purple"></div>
                            </li>
                            <li data-theme="blue">
                                <div class="blue"></div>
                            </li>
                            <li data-theme="cyan" class="active">
                                <div class="cyan"></div>
                            </li>
                            <li data-theme="green">
                                <div class="green"></div>
                            </li>
                            <li data-theme="orange">
                                <div class="orange"></div>
                            </li>
                            <li data-theme="blush">
                                <div class="blush"></div>
                            </li>
                            <li data-theme="red">
                                <div class="red"></div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>



        <!-- mani page content body part -->
        <div id="main-content">
            <div class="container-fluid">
                {{ block "content" . }}{{ end }}
            </div>
        </div>

    </div>

    <!-- Javascript -->
    <script src="/assets/bundles/libscripts.bundle.js"></script>
    <script src="/assets/bundles/vendorscripts.bundle.js"></script>

    <!-- page vendor js file -->
    <script src="/assets/vendor/toastr/toastr.js"></script>
    <script src="/assets/bundles/c3.bundle.js"></script>

    <!-- page js file -->
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/dataTables.responsive.min.js"></script>
    <script src="https://cdn.datatables.net/responsive/2.5.0/js/responsive.bootstrap4.min.js"></script>
    <script src="/assets/bundles/mainscripts.bundle.js"></script>
    <!-- Specific scripts will be loaded here -->

    <script>
        function logout() {
            document.cookie = "Authorization=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
            window.location.href = "/login";
        }

        // Sidebar Mini Stats GÃ¼ncelleme
        document.addEventListener("DOMContentLoaded", function () {
            fetch('/api/stats/mini')
                .then(response => response.json())
                .then(data => {
                    if (document.getElementById('mini-stat-files')) {
                        document.getElementById('mini-stat-files').innerText = data.totalFiles;
                    }
                    if (document.getElementById('mini-stat-clients')) {
                        document.getElementById('mini-stat-clients').innerText = data.totalClients;
                    }
                    if (document.getElementById('mini-stat-balance')) {
                        document.getElementById('mini-stat-balance').innerText = data.totalBalance;
                    }
                })
                .catch(error => console.error('Sidebar stats error:', error));
        });
        // ... (DiÄŸer scriptler: logout, mini-stats) ...

        // ðŸ” GLOBAL SEARCH LOGIC (JQUERY UI AUTOCOMPLETE veya BASÄ°T LISTENER)
        // ... (Mevcut kod) ...

        // ðŸŒŸ SIDEBAR ACTIVE STATE LOGIC
        // URL'e bakarak hangi menÃ¼nÃ¼n "active" olacaÄŸÄ±nÄ± belirler
        document.addEventListener("DOMContentLoaded", function () {
            const currentPath = window.location.pathname;

            // Her ÅŸeyi temizle Ã¶nce
            document.querySelectorAll('#main-menu li').forEach(li => li.classList.remove('active'));
            document.querySelectorAll('#main-menu ul').forEach(ul => ul.classList.remove('in'));
            document.querySelectorAll('#main-menu a').forEach(a => {
                a.setAttribute('aria-expanded', 'false');
                a.classList.remove('active');
            });

            let activeMenuId = "menu-dashboard"; // VarsayÄ±lan

            if (currentPath.startsWith("/clients")) {
                activeMenuId = "menu-clients";
            } else if (currentPath.startsWith("/cases")) {
                activeMenuId = "menu-cases";
            } else if (currentPath.startsWith("/hearings")) {
                activeMenuId = "menu-hearings";
            } else if (currentPath.startsWith("/accounting")) {
                activeMenuId = "menu-accounting";
            }

            // Ana menÃ¼yÃ¼ aktif et
            const activeLi = document.getElementById(activeMenuId);
            if (activeLi) {
                activeLi.classList.add('active');

                // Alt menÃ¼ varsa aÃ§
                const subMenu = activeLi.querySelector('ul');
                const toggleLink = activeLi.querySelector('a.has-arrow');
                if (subMenu) {
                    subMenu.classList.add('in'); // Bootstrap/MetisMenu "in" class ile aÃ§Ä±lÄ±yor
                    subMenu.setAttribute('aria-expanded', 'true');
                }
                if (toggleLink) {
                    toggleLink.classList.add('active');
                    toggleLink.setAttribute('aria-expanded', 'true');
                }
            }
        });
        // Bootstrap Typeahead benzeri bir yapÄ±
        document.addEventListener("DOMContentLoaded", function () {
            const searchInput = document.querySelector('#navbar-search input');
            const searchForm = document.querySelector('#navbar-search');
            let timeout = null;

            // SonuÃ§larÄ± gÃ¶sterecek bir dropdown div oluÅŸturalÄ±m
            const resultsDiv = document.createElement('div');
            resultsDiv.className = 'dropdown-menu show';
            resultsDiv.style.display = 'none';
            resultsDiv.style.width = '100%';
            resultsDiv.style.position = 'absolute';
            resultsDiv.style.top = '100%';
            resultsDiv.style.left = '0';
            resultsDiv.style.maxHeight = '300px';
            resultsDiv.style.overflowY = 'auto';
            searchForm.style.position = 'relative'; // Dropdown'Ä± buna gÃ¶re konumlandÄ±r
            searchForm.appendChild(resultsDiv);

            searchInput.addEventListener('input', function (e) {
                const query = e.target.value.trim();

                // Ã–nce varsa bekleyen isteÄŸi iptal et (Debounce)
                clearTimeout(timeout);

                if (query.length < 2) {
                    resultsDiv.style.display = 'none';
                    return;
                }

                // 300ms gecikmeli istek at
                timeout = setTimeout(() => {
                    fetch('/api/search?q=' + encodeURIComponent(query))
                        .then(res => res.json())
                        .then(data => {
                            resultsDiv.innerHTML = '';
                            if (data && data.length > 0) {
                                data.forEach(item => {
                                    const a = document.createElement('a');
                                    a.className = 'dropdown-item';
                                    a.href = item.url;
                                    a.innerHTML = `
                                    <small class="text-muted float-right">${item.type}</small>
                                    <strong>${item.title}</strong><br>
                                    <span class="text-muted font-12">${item.meta}</span>
                                `;
                                    resultsDiv.appendChild(a);
                                });
                                resultsDiv.style.display = 'block';
                            } else {
                                resultsDiv.innerHTML = '<span class="dropdown-item text-muted">SonuÃ§ bulunamadÄ±</span>';
                                resultsDiv.style.display = 'block';
                            }
                        })
                        .catch(err => console.error(err));
                }, 300);
            });

            // Input dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapat
            document.addEventListener('click', function (e) {
                if (!searchForm.contains(e.target)) {
                    resultsDiv.style.display = 'none';
                }
            });
        });
    </script>

    {{ block "scripts" . }}{{ end }}

</body>

</html>